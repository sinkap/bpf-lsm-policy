[
    {
        "name": "bpf-lsm-tester.qcow2",
        "packages": [
            "bpftool",
            "ca-certificates",
            "curl",
            "iproute2",
            "openssh-server",
            "sudo",
            "util-linux",
            "binutils",
            "make",
            "git",
            "clang",
            "llvm",
            "libbpf-dev",
            "libelf-dev",
            "systemd-resolved",
            "qemu-utils"
        ],
        "actions": [
            {
                "comment": "disable password for root",
                "op": {
                    "Cmd": "passwd -d root"
                },
                "type": "run-command"
            },
            {
                "comment": "copy the scripts directory into the root of the VM",
                "op": {
                    "LocalPath": "scripts",
                    "RemoteDir": "/"
                },
                "type": "copy-in"
            },
            {
                "comment": "execute the copied network script",
                "op": {
                    "Cmd": "/scripts/networkd.sh"
                },
                "type": "run-command"
            },
            {
                "comment": "execute the copied sshd script",
                "op": {
                    "Cmd": "/scripts/sshd.sh"
                },
                "type": "run-command"
            },
            {
                "comment": "Run fstab setup to auto-mount /host",
                "op": {
                    "Cmd": "/scripts/fstab.sh"
                },
                "type": "run-command"
            },
            {
                "comment": "clean up the scripts so they don't bloat the final image",
                "op": {
                    "Cmd": "rm -rf /scripts"
                },
                "type": "run-command"
            }
        ]
    }
]
